<div class="container mt-4">
    <h2 class="mb-4">Гостевая книга (SPA)</h2>

    @if (Context.Session.GetString("UserId") != null)
    {
        <div class="mb-3">
            <textarea id="messageInput" class="form-control" rows="3" placeholder="Введите сообщение..."></textarea>
        </div>

        <button id="sendBtn" class="btn btn-primary mb-4">Добавить</button>
    }

    <div id="messages"></div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    function loadMessages() {
        $.get("/Home/GetMessagesAjax", function (data) {
            let html = "";
            data.forEach(m => {
                html += `
                    <div class="card mb-3 shadow-sm">
                        <div class="card-body">
                            <h6 class="text-muted">Пользователь: ${m.userId} — ${m.date}</h6>
                            <p>${m.text}</p>
                        </div>
                    </div>`;
            });

            $("#messages").html(html);
        });
    }

    $("#sendBtn").click(function () {
        const text = $("#messageInput").val();

        if (text.trim() === "") return;

        $.post("/Home/AddMessageAjax", { message: text }, function (response) {
            if (response.success) {
                $("#messageInput").val("");
                loadMessages();
            } else {
                alert(response.error);
            }
        });
    });

    $(document).ready(function () {
        loadMessages();
    });
</script>
